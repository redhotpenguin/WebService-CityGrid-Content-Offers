package WebService::CityGrid::Content::Offers;

our $VERSION = 0.01;

use Any::Moose;
use LWP::UserAgent;
use XML::LibXML;

has 'what'      => ( is => 'ro', isa => 'Str', required => 1 );
has 'where'     => ( is => 'ro', isa => 'Str', required => 1 );
has 'publisher' => ( is => 'ro', isa => 'Str', required => 1 );
has 'rpp'       => ( is => 'ro', isa => 'Str', required => 0 );

use constant DEBUG => $ENV{CG_DEBUG} || 0;

our $Endpoint = "http://api.citygridmedia.com/content/offers/v2/search";
our $Ua = LWP::UserAgent->new( agent => join( '_', __PACKAGE__, $VERSION ) );
our $Parser = XML::LibXML->new;

=head1 METHODS

=over 4

=item query

  $res = $Cg->query({
      where => '90210',
      what  => 'pizza%20and%20burgers', });

Queries the web service.  Dies if the http request fails, so eval it!

=cut

sub query {
    my ( $self, $args ) = @_;

    my $url = "$Endpoint?" . 'publisher=' . $self->publisher . '&';

    foreach my $attr (qw( what where )) {

        $url .= join( '=', $attr, $self->$attr ) . '&';
    }
    $url = substr( $url, 0, length($url) - 1 );

    warn("cg query $url") if DEBUG;

    $Ua->timeout(5);
    my $res = $Ua->get($url);

    die "query for $url failed!" unless $res->is_success;

    my $dom = $Parser->load_xml( string => $res->decoded_content );
    my @offers = $dom->documentElement->getElementsByTagName('offers');

    my @results;
    foreach my $offer (@offers) {

        $DB::single = 1;
        warn( "raw offer: " . $offer->toString ) if DEBUG;

        next if $offer->toString eq '<offers/>';

        my %new_args;
        foreach my $attr (
            qw( offer_type offer_source impression_id listing_id
            latitude longitude phone description state city name
            image_url attribution_text postal_code street
            )
          )
        {

            my $val = $offer->getElementsByTagName($attr);
            if ($val) {
                my $firstchild = $val->[0]->firstChild;
                $new_args{$attr} = ($firstchild) ? $firstchild->data : '';
            }
        }

        $new_args{id} = substr(
            $offer->getElementsByTagName('id')->[0]->firstChild->data,
            3,
            length( $offer->getElementsByTagName('id')->[0]->firstChild->data )
        );
        $DB::single = 1;
        my $result =
          WebService::CityGrid::Content::Offers::Offer->new( \%new_args );

        push @results, $result;
    }

    return unless @results;

    return \@results;
}

__PACKAGE__->meta->make_immutable;

package WebService::CityGrid::Content::Offers::Offer;

use Any::Moose;

has 'id'            => ( is => 'ro', isa => 'Int', required => 1 );
has 'offer_type'    => ( is => 'ro', isa => 'Str', required => 1 );
has 'offer_source'  => ( is => 'ro', isa => 'Str', required => 1 );
has 'impression_id' => ( is => 'ro', isa => 'Str', required => 1 );
has 'image_url'     => ( is => 'ro', isa => 'Str', required => 1 );
has 'listing_id'    => ( is => 'ro', isa => 'Str', required => 0 );
has 'name'          => ( is => 'ro', isa => 'Str', required => 1 );
has 'street'        => ( is => 'ro', isa => 'Str', required => 1 );
has 'city'          => ( is => 'ro', isa => 'Str', required => 1 );
has 'state'         => ( is => 'ro', isa => 'Str', required => 1 );
has 'postal_code'   => ( is => 'ro', isa => 'Str', required => 1 );
has 'latitude'      => ( is => 'ro', isa => 'Str', required => 1 );
has 'longitude'     => ( is => 'ro', isa => 'Str', required => 1 );
has 'phone'         => ( is => 'ro', isa => 'Str', required => 1 );
has 'description'   => ( is => 'ro', isa => 'Str', required => 1 );

=cut


<?xml version=\'1.0\' encoding=\'UTF-8\'?>

<results total_hits="18" rpp="20" page="1" last_hit="18" first_hit="1">
<uri>http://api.citygridmedia.com/search/offers/v2/search?has_budget=true&amp;format=xml&amp;page=1&amp;rpp=20&amp;histograms=false&amp;what=car&amp;where=94109&amp;publisher=test&amp;region_type=circle</uri>
<did_you_mean xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/>

<regions>
  <region type="market">
    <name>San Francisco, CA Metro</name>
    <latitude>37.762546</latitude>
    <longitude>-122.579157</longitude>
    <default_radius>42.4400</default_radius>
    </region></regions><histograms/><offers><offer><attribution_logo>http://images.citysearch.net/assets/imgdb/custom/ue-357/CS_logo88x31.jpg</attribution_logo><attribution_source>CUSTOMER</attribution_source><attribution_text>Citysearch</attribution_text><attribution_url xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><id>cg_74892252</id><reference_id>1</reference_id><impression_id>000b000002e50c20c065e54802b24578cf867541c6</impression_id><title>20% OFF on any body repair.</title><description>Get 20% off on repair. Ask us about discounts on insurance deductables.</description><redemption_type_id>1</redemption_type_id><redemption_type>Print</redemption_type><terms>Cannot combine with any other offer.</terms><redemption_url xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><offer_source>CUSTOMER</offer_source><offer_types><offer_type>percentoff</offer_type></offer_types><image_url>http://images.citysearch.net/assets/imgdb/merchant/2011/1/6/0/jpsqhjHD79_100x100.jpeg</image_url><start_date>2011-01-05T00:00:00.000Z</start_date><expiration_date xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><popularity xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><face_value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><discount_value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><locations><location><id>864542</id><infousa_id>102390051</infousa_id><rating>10.0</rating><name>Domport Auto Body</name><address><street>362 Fell St</street><city>San Francisco</city><state>CA</state><postal_code>94102</postal_code></address><phone>4158612355</phone><latitude>37.7759</latitude><longitude>-122.4237</longitude><image_url>http://images.citysearch.net/assets/imgdb/merchant/2011/1/6/0/dFgtDPoB91_100x100.jpeg</image_url><business_hours>Mon-Fri 8am-6pm
 Sat: 9am-4pm</business_hours><tags><tag id="352" primary="false">Towing</tag><tag id="6047" primary="false">Car Washes</tag><tag id="12751" primary="false">Auto Detailing</tag><tag id="6046" primary="false">Auto Body Paint &amp; Repair</tag><tag id="269" primary="false">Auto Restoration</tag><tag id="268" primary="true">Automotive Repair</tag><tag id="350" primary="false">Towing &amp; Wrecking</tag><tag id="237" primary="false">Automotive Sales &amp; Services</tag></tags><public_id>domport-auto-body-san-francisco</public_id></location></locations><offer_collapse_count xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/></offer><offer><attribution_logo>http://images.citysearch.net/assets/imgdb/custom/ue-357/CS_logo88x31.jpg</attribution_logo><attribution_source>CUSTOMER</attribution_source><attribution_text>Citysearch</attribution_text><attribution_url xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><id>cg_45288592</id><reference_id>11</reference_id><impression_id>000b0000029b00e950155b410588edd6ce0c421475</impression_id><title>10% off labor on any repairs over $200</title><description>10% off labor on any repairs over $200</description><redemption_type_id>1</redemption_type_id><redemption_type>Print</redemption_type><terms xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><redemption_url xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><offer_source>CUSTOMER</offer_source><offer_types><offer_type>percentoff</offer_type></offer_types><image_url xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><start_date xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><expiration_date xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><popularity xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><face_value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><discount_value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><locations><location><id>602698202</id><infousa_id xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><rating>9.0</rating><name>Auto City Repair &amp; Body Works</name><address><street>834 Divisadero St.</street><city>San Francisco</city><state>CA</state><postal_code>94117</postal_code></address><phone>4154408884</phone><latitude>37.777181</latitude><longitude>-122.438227</longitude><image_url>http://images.citysearch.net/assets/imgdb/98/4e/e3/b5/2a/42/4e/d1/ad/c6/ca/f7/4e/e5/a5/67_100x100.jpg</image_url><business_hours>Monday - Friday
8 a.m. - 5 p.m</business_hours><tags><tag id="12753" primary="false">Oil Changes</tag><tag id="6046" primary="false">Auto Body Paint &amp; Repair</tag><tag id="12749" primary="false">Brake Repair</tag><tag id="268" primary="true">Automotive Repair</tag><tag id="12757" primary="false">Smog Testing</tag><tag id="237" primary="false">Automotive Sales &amp; Services</tag></tags><public_id>auto-city-repair-body-works-san-francisco</public_id></location></locations><offer_collapse_count xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/></offer><offer><attribution_logo>http://images.citysearch.net/assets/imgdb/custom/ue-357/CS_logo88x31.jpg</attribution_logo><attribution_source>CUSTOMER</attribution_source><attribution_text>Citysearch</attribution_text><attribution_url xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><id>cg_45288572</id><reference_id>11</reference_id><impression_id>000b0000026a66995edeb541c1b423fef07b9e50de</impression_id><title>$29.95 Oil Change on most cars up to 5 quarts</title><description>$29.95 Oil Change on most cars up to 5 quarts</description><redemption_type_id>1</redemption_type_id><redemption_type>Print</redemption_type><terms xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><redemption_url xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><offer_source>CUSTOMER</offer_source><offer_types><offer_type>dollarsoff</offer_type></offer_types><image_url xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><start_date xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><expiration_date xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><popularity xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><face_value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><discount_value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><locations><location><id>602698202</id><infousa_id xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><rating>9.0</rating><name>Auto City Repair &amp; Body Works</name><address><street>834 Divisadero St.</street><city>San Francisco</city><state>CA</state><postal_code>94117</postal_code></address><phone>4154408884</phone><latitude>37.777181</latitude><longitude>-122.438227</longitude><image_url>http://images.citysearch.net/assets/imgdb/98/4e/e3/b5/2a/42/4e/d1/ad/c6/ca/f7/4e/e5/a5/67_100x100.jpg</image_url><business_hours>Monday - Friday
8 a.m. - 5 p.m</business_hours><tags><tag id="12753" primary="false">Oil Changes</tag><tag id="6046" primary="false">Auto Body Paint &amp; Repair</tag><tag id="12749" primary="false">Brake Repair</tag><tag id="268" primary="true">Automotive Repair</tag><tag id="12757" primary="false">Smog Testing</tag><tag id="237" primary="false">Automotive Sales &amp; Services</tag></tags><public_id>auto-city-repair-body-works-san-francisco</public_id></location></locations><offer_collapse_count xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/></offer><offer><attribution_logo>http://images.citysearch.net/assets/imgdb/custom/ue-357/CS_logo88x31.jpg</attribution_logo><attribution_source>CUSTOMER</attribution_source><attribution_text>Citysearch</attribution_text><attribution_url xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><id>cg_7825170</id><reference_id>11</reference_id><impression_id>000b000002e976b6859b2145f893aa51136b39ecd8</impression_id><title>10 percent off parts with major repairs</title><description>Mention Citysearch and present this coupon to get 10 percent off parts with major repairs.</description><redemption_type_id>1</redemption_type_id><redemption_type>Print</redemption_type><terms xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><redemption_url xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><offer_source>CUSTOMER</offer_source><offer_types><offer_type>percentoff</offer_type></offer_types><image_url xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><start_date xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><expiration_date xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><popularity xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><face_value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><discount_value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><locations><location><id>881113</id><infousa_id>833939663</infousa_id><rating>9.0</rating><name>Automatic Transmission Center</name><address><street>5620 Mission St</street><city>San Francisco</city><state>CA</state><postal_code>94112</postal_code></address><phone>4153378800</phone><latitude>37.7113</latitude><longitude>-122.447</longitude><image_url>http://images.citysearch.net/assets/imgdb/advertorial_profile/27/a2/V-SFOCA-55100535_ID191830_guide_inclusion_100x100.jpg</image_url><business_hours>Mon-Fri 8am-5:30pm</business_hours><tags><tag id="11361" primary="false">MasterCard</tag><tag id="12743" primary="false">Transmission Repair</tag><tag id="11382" primary="false">Visa</tag><tag id="1738" primary="false">Global</tag><tag id="12747" primary="false">Clutch Repair</tag><tag id="268" primary="true">Automotive Repair</tag><tag id="11341" primary="false">Check</tag><tag id="237" primary="false">Automotive Sales &amp; Services</tag></tags><public_id>automatic-transmission-center-san-francisco</public_id></location></locations><offer_collapse_count xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/></offer><offer><attribution_logo>http://images.citysearch.net/assets/imgdb/custom/ue-357/CS_logo88x31.jpg</attribution_logo><attribution_source>CUSTOMER</attribution_source><attribution_text>Citysearch</attribution_text><attribution_url xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><id>cg_55360520</id><reference_id>1</reference_id><impression_id>000b0000022849fca22f624767a2935de16b2bc9d4</impression_id><title>FREE Brake Inspection.</title><description>Free Brake Inspection When you mention Citysearch.</description><redemption_type_id>1</redemption_type_id><redemption_type>Print</redemption_type><terms xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><redemption_url xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><offer_source>CUSTOMER</offer_source><offer_types><offer_type>free</offer_type></offer_types><image_url xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><start_date xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><expiration_date>2013-03-29T00:00:00.000Z</expiration_date><popularity xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><face_value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><discount_value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><locations><location><id>905037</id><infousa_id xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><rating>9.0</rating><name>T &amp; R AUTOMOTIVE CENTER</name><address><street>3898 California St</street><city>San Francisco</city><state>CA</state><postal_code>94118</postal_code></address><phone>4157520646</phone><latitude>37.785673</latitude><longitude>-122.459185</longitude><image_url>http://images.citysearch.net/assets/imgdb/advertorial_profile/c1/20/V-SFOCA-55054489_ID80224_guide_inclusion_100x100.jpg</image_url><business_hours xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><tags><tag id="12832" primary="false">Tune Ups</tag><tag id="12742" primary="false">Muffler Repair</tag><tag id="12743" primary="false">Transmission Repair</tag><tag id="1738" primary="false">Global</tag><tag id="12747" primary="false">Clutch Repair</tag><tag id="12748" primary="false">Radiator Repair</tag><tag id="12749" primary="false">Brake Repair</tag><tag id="6186" primary="false">Truck Repair</tag><tag id="10337" primary="false">Unocal</tag><tag id="309" primary="true">Gas Stations</tag><tag id="11361" primary="false">MasterCard</tag><tag id="11349" primary="false">Discover</tag><tag id="11382" primary="false">Visa</tag><tag id="11333" primary="false">American Express</tag><tag id="268" primary="false">Automotive Repair</tag><tag id="237" primary="false">Automotive Sales &amp; Services</tag></tags><public_id>t-r-automotive-center-san-francisco</public_id></location></locations><offer_collapse_count xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/></offer><offer><attribution_logo>http://images.citysearch.net/assets/imgdb/custom/ue-357/CS_logo88x31.jpg</attribution_logo><attribution_source>CUSTOMER</attribution_source><attribution_text>Citysearch</attribution_text><attribution_url xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><id>cg_55361770</id><reference_id>1</reference_id><impression_id>000b0000020e96c31e1ee449ad92f5ce40bf245098</impression_id><title>Review Special.</title><description>Please write a review about us on Citysearch - Bring in a copy of your positive review of T&amp;R Automotive Center and receive a 10% discount on the total labor charge</description><redemption_type_id>1</redemption_type_id><redemption_type>Print</redemption_type><terms xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><redemption_url xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><offer_source>CUSTOMER</offer_source><offer_types><offer_type>percentoff</offer_type></offer_types><image_url xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><start_date xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><expiration_date>2012-01-27T00:00:00.000Z</expiration_date><popularity xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><face_value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><discount_value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><locations><location><id>905037</id><infousa_id xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><rating>9.0</rating><name>T &amp; R AUTOMOTIVE CENTER</name><address><street>3898 California St</street><city>San Francisco</city><state>CA</state><postal_code>94118</postal_code></address><phone>4157520646</phone><latitude>37.785673</latitude><longitude>-122.459185</longitude><image_url>http://images.citysearch.net/assets/imgdb/advertorial_profile/c1/20/V-SFOCA-55054489_ID80224_guide_inclusion_100x100.jpg</image_url><business_hours xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><tags><tag id="12832" primary="false">Tune Ups</tag><tag id="12742" primary="false">Muffler Repair</tag><tag id="12743" primary="false">Transmission Repair</tag><tag id="1738" primary="false">Global</tag><tag id="12747" primary="false">Clutch Repair</tag><tag id="12748" primary="false">Radiator Repair</tag><tag id="12749" primary="false">Brake Repair</tag><tag id="6186" primary="false">Truck Repair</tag><tag id="10337" primary="false">Unocal</tag><tag id="309" primary="true">Gas Stations</tag><tag id="11361" primary="false">MasterCard</tag><tag id="11349" primary="false">Discover</tag><tag id="11382" primary="false">Visa</tag><tag id="11333" primary="false">American Express</tag><tag id="268" primary="false">Automotive Repair</tag><tag id="237" primary="false">Automotive Sales &amp; Services</tag></tags><public_id>t-r-automotive-center-san-francisco</public_id></location></locations><offer_collapse_count xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/></offer><offer><attribution_logo>http://images.citysearch.net/assets/imgdb/custom/ue-357/CS_logo88x31.jpg</attribution_logo><attribution_source>CUSTOMER</attribution_source><attribution_text>Citysearch</attribution_text><attribution_url xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><id>cg_55216602</id><reference_id>11</reference_id><impression_id>000b0000025bc3c374c24b408fba696f227cbc7eab</impression_id><title>Visit Our Website!</title><description>View specials, inventory, and more at www.toyotamarin.com</description><redemption_type_id>1</redemption_type_id><redemption_type>Print</redemption_type><terms>Visit Our Website!</terms><redemption_url xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><offer_source>CUSTOMER</offer_source><offer_types><offer_type>other</offer_type></offer_types><image_url xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><start_date>2010-06-10T00:00:00.000Z</start_date><expiration_date xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><popularity xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><face_value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><discount_value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><locations><location><id>605257160</id><infousa_id xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><rating>8.0</rating><name>Toyota Marin</name><address><street>445 E Francisco Blvd</street><city>San Rafael</city><state>CA</state><postal_code>94901</postal_code></address><phone>8886968230</phone><latitude>37.967489</latitude><longitude>-122.518173</longitude><image_url>http://images.citysearch.net/assets/imgdb/merchant/2010/6/10/0/dSIgNFMp78_100x100.jpeg</image_url><business_hours>Sales Mon-Fri: 9:00am - 9:00pm Sat: 9:00am - 9:00pm Sun: 10:00am - 7:00pm Service &amp; Parts Mon-Fri: 7:00am - 6:00pm Sat: 7:00am - 6:00pm Sun: Closed</business_hours><tags><tag id="245" primary="false">New Car Dealers</tag><tag id="259" primary="false">Auto Rentals</tag><tag id="238" primary="false">Auto Dealers</tag><tag id="237" primary="true">Automotive Sales &amp; Services</tag></tags><public_id>toyota-marin-san-rafael-4</public_id></location></locations><offer_collapse_count xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/></offer><offer><attribution_logo>http://images.citysearch.net/assets/imgdb/custom/ue-357/CS_logo88x31.jpg</attribution_logo><attribution_source>CUSTOMER</attribution_source><attribution_text>Citysearch</attribution_text><attribution_url xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><id>cg_74927282</id><reference_id>11</reference_id><impression_id>000b0000027b73132b08b443b7a0fde93535e709f1</impression_id><title>AAA Members Special!</title><description>AAA Members are entitled to 10% off labor ($100.00 maximum), must show AAA card with proper ID.</description><redemption_type_id>1</redemption_type_id><redemption_type>Print</redemption_type><terms>*You cannot combine offers.</terms><redemption_url xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><offer_source>CUSTOMER</offer_source><offer_types><offer_type>percentoff</offer_type></offer_types><image_url xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><start_date>2011-01-07T00:00:00.000Z</start_date><expiration_date xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><popularity xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><face_value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><discount_value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><locations><location><id>828991</id><infousa_id>101795961</infousa_id><rating>8.0</rating><name>Spiteri\'s Auto Service</name><address><street>292 Old County Rd</street><city>Belmont</city><state>CA</state><postal_code>94002</postal_code></address><phone>6505934758</phone><latitude>37.5273</latitude><longitude>-122.2834</longitude><image_url>http://images.citysearch.net/assets/imgdb/guide/2010/6/21/0/ULyyMxUG129_100x100.jpeg</image_url><business_hours>Mon-Fri 7am-5pm</business_hours><tags><tag id="12753" primary="false">Oil Changes</tag><tag id="12742" primary="false">Muffler Repair</tag><tag id="12743" primary="false">Transmission Repair</tag><tag id="1738" primary="false">Global</tag><tag id="11369" primary="false">Parking Lot</tag><tag id="12748" primary="false">Radiator Repair</tag><tag id="12749" primary="false">Brake Repair</tag><tag id="12757" primary="false">Smog Testing</tag><tag id="11377" primary="false">Street Parking</tag><tag id="11361" primary="false">MasterCard</tag><tag id="11339" primary="false">Cash</tag><tag id="11349" primary="false">Discover</tag><tag id="11382" primary="false">Visa</tag><tag id="258" primary="false">Tires</tag><tag id="11333" primary="false">American Express</tag><tag id="257" primary="false">Tires &amp; Wheels</tag><tag id="11347" primary="false">Debit Card</tag><tag id="268" primary="true">Automotive Repair</tag><tag id="255" primary="false">Auto Parts &amp; Accessories</tag><tag id="237" primary="false">Automotive Sales &amp; Services</tag></tags><public_id>spiteris-auto-service-belmont</public_id></location></locations><offer_collapse_count xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/></offer><offer><attribution_logo>http://images.citysearch.net/assets/imgdb/custom/ue-357/CS_logo88x31.jpg</attribution_logo><attribution_source>CUSTOMER</attribution_source><attribution_text>Citysearch</attribution_text><attribution_url xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><id>cg_74927312</id><reference_id>11</reference_id><impression_id>000b000002d6cff7bd7bf4480097a2c8cc3f1b44e5</impression_id><title>10% Off on Tires!</title><description>Purchase of Any 4 Tires
10% off call for best tire pricing. Michelin, Uniroyal and BF Goodrich.</description><redemption_type_id>1</redemption_type_id><redemption_type>Print</redemption_type><terms>*You cannot combine offers</terms><redemption_url xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><offer_source>CUSTOMER</offer_source><offer_types><offer_type>percentoff</offer_type></offer_types><image_url>http://images.citysearch.net/assets/imgdb/merchant/2011/1/17/0/jyFQgIHs78_100x100.jpeg</image_url><start_date>2011-01-07T00:00:00.000Z</start_date><expiration_date xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><popularity xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><face_value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><discount_value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><locations><location><id>828991</id><infousa_id>101795961</infousa_id><rating>8.0</rating><name>Spiteri\'s Auto Service</name><address><street>292 Old County Rd</street><city>Belmont</city><state>CA</p://images.citysearch.net/assets/imgdb/custom/uesi:nil="true"/><id>cg_74927362</id><reference_id>11</reference_id><impression_id>000b000002be &amp; maintenance items and AAA maintenance inspection.</description><redemption_type_id>1<stance" xsi:nil="true"/><offer_source>CUSTOMER</offer_source><offer_types><offer_type>other</offer_type></offer_types><image_url xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><start_date>2011-01-07T00:00:00.000Z</start_date><expiration_date xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><popularity xmlns:xsi="ue xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><locations><location><id/city><state>CA</state><postal_code>94002</postal_code></address><phone>6505934758</phone><latitu><business_hours>Mon-Fri 7am-5pm</business_hours><tags><tag id="12753" primary="false">Oil Ch<tag id="11369" primary="false">Parking Lot</tag><tag id="12748" primaryag id="11361" primary="false">MasterCarn Express</taRfalse">Automotive Sales &amp; Services</tag></tags><public_id>spiteris-auto-service-belmont</pub//images.citysearch.net/assets/imgdb/custom/ue-357/CS_logo88x31.jpg</attribution_logo><attribution_ss:nil="true"/><id>cg_80693082</id><reference_id>11</reference_id><impression_id>000b0000026cfb3b639ef44dd9b for mentioning City Search</description><redemption_type_id>1</redemption_type_id><redemption_<offer_source>CUSTOMER</offer_source><offer_types><offer_type>percentoff</offer_type></offer_types><"http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><popularity xmlns:xsi="http://www.w3.or//www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><locations><location><id>867766</id><infousa_code>94103</postal_code></address><phone>4154575205</phone><latitude>37.7749</latitude><longitudp://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><tags><tag id="1987" primary="false">Home Ive Repair</tag><tag id="1932" primary="false">Home &amp; Garden</tag><tag id="253" primary="faln-francisco</public_id></location></locations><offer_collapse_count xmlns:xsi="http://www.w3.or_logo><attribution_source>CUSTOMER</attribution_source><attribution_00b000002ed8c74a2727f4a2fa74cbe116a6755ed</impression_id><title>Download the Ferrari Virtual Acadl winners: a trip to Maranello and a training session with the Scuderia</description><redemption_tame/en/index.jsp</redemption_url><offer_source>CUSTOMER</offer_source><o24T00:00:00.000Z</start_date><expiration_date xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><discount_value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instancewww.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><name>Ferrari of Silicon Valley</name><address>.471</latitude><longitude>-122.2147</longitude><image_url>http://images.citysearch.net/as="238" primary="true">Auto Dealers</tag><tag id="237" primary="false">Automotive Sales &amp; ServLSchema-instance" xsi:nil="trttribution_url xon citysearch offer &amp; receive 15% OFF labor!!!</description><redemption_type_id>1</redemption_type_id><redemption_type>Print</redemption_type><terms/www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><offer_source>CUSTOMER</offer_source><offer_types><offer_type>percentoff</offer_type></offer_types><image_url xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><start_date xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><expiration_date xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><popularity xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><face_value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><discount_value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><locations><location><id>603289092</id><infousa_id xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><rating xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><name>Liebes Auto Body</name><address><street>2549 Middlefield Rd</street><city>Redwood City</city><state>CA</state><postal_code>94063</postal_code></address><phone>6503658478</phone><latitude>37.478325</latitude><longitude>-122.213869</longitude><image_url>http://images.citysearch.net/assets/imgdb/9f/9f/a5/d4/e7/a6/49/28/bc/c6/60/f2/0d/4c/bf/de_100x100.JPG</image_url><business_hours xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><tags><tag id="6046" primary="true">Auto Body Paint &amp; Repair</tag><tag id="268" primary="false">Automotive Repair</tag><tag id="237" primary="false">Automotive Sales &amp; Services</tag></tags><public_id>liebes-auto-body-redwood-city</public_id></location></locations><offer_collapse_count xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/></offer><offer><attribution_logo>http://images.citysearch.net/assets/imgdb/custom/ue-357/CS_logo88x31.jpg</attribution_logo><attribution_source>CUSTOMER</attribution_source><attribution_text>Citysearch</attribution_text><attribution_url xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><id>cg_82669272</id><reference_id>11</reference_id><impression_id>000b00000239cf85f889ab4af59b4f22f82840b59d</impression_id><title>Visit Our Website</title><description>View specials, inventory, and more at sftoyota.com</description><redemption_type_id>1</redemption_type_id><redemption_type>Print</redemption_type><terms>Visit Our Website</terms><redemption_url xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><offer_source>CUSTOMER</offer_source><offer_types><offer_type>other</offer_type></offer_types><image_url xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><start_date>2011-07-29T00:00:00.000Z</start_date><expiration_date xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><popularity xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><face_value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><discount_value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><locations><location><id>605096270</id><infousa_id>3057908</infousa_id><rating xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><name>SAN FRANCISCO TOYOTA</name><address><street>3800 Geary Blvd</street><city>San Francisco</city><state>CA</state><postal_code>94118</postal_code></address><phone>4157508300</phone><latitude>37.781279</latitude><longitude>-122.46002</longitude><image_url xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><business_hours>Sales
Mon-Fri: 8:30am - 7:00pm
Sat: 10:00am - 6:00pm
Sun: 11:00am - 6:00pm
Service
Mon-Fri: 7:00am - 7:00pm
Sat: 7:00am - 7:00pm
Sun: Closed
Parts
Mon-Fri: 7:00am - 5:30pm
Sat: Closed
Sun: Closed</business_hours><tags><tag id="251" primary="false">Used Car Dealers</tag><tag id="10163" primary="false">Volkswagen</tag><tag id="10162" primary="false">Toyota</tag><tag id="16650" primary="false">Scion</tag><tag id="1738" primary="false">Global</tag><tag id="10098" primary="false">Toyota</tag><tag id="11361" primary="false">MasterCard</tag><tag id="11349" primary="false">Discover</tag><tag id="11382" primary="false">Visa</tag><tag id="245" primary="false">New Car Dealers</tag><tag id="10300" primary="false">Toyota</tag><tag id="16640" primary="false">Scion</tag><tag id="10138" primary="false">Honda</tag><tag id="259" primary="false">Auto Rentals</tag><tag id="268" primary="false">Automotive Repair</tag><tag id="4334" primary="false">Wholesalers</tag><tag id="4335" primary="false">Exporters</tag><tag id="10153" primary="false">Nissan</tag><tag id="238" primary="false">Auto Dealers</tag><tag id="255" primary="false">Auto Parts &amp; Accessories</tag><tag id="237" primary="true">Automotive Sales &amp; Services</tag></tags><public_id>san-francisco-toyota-san-francisco-2</public_id></location></locations><offer_collapse_count xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/></offer><offer><attribution_logo>http://images.citysearch.net/assets/imgdb/custom/ue-357/CS_logo88x31.jpg</attribution_logo><attribution_source>CUSTOMER</attribution_source><attribution_text>Citysearch</attribution_text><attribution_url xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><id>cg_87391452</id><reference_id>1</reference_id><impression_id>000b000002c1e7746b8c14431d953fe5e419147a2d</impression_id><title>$150 off transmission repair</title><description>Receive $150 off major transmission repair</description><redemption_type_id>1</redemption_type_id><redemption_type>Print</redemption_type><terms>this offer is valid for most cars.</terms><redemption_url xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><offer_source>CUSTOMER</offer_source><offer_types><offer_type>dollarsoff</offer_type></offer_types><image_url xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><start_date>2011-12-30T00:00:00.000Z</start_date><expiration_date xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><popularity xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><face_value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><discount_value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><locations><location><id>605344572</id><infousa_id xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><rating xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><name>Valencia Auto Clinic</name><address><street>1633 Valencia St</street><city>San Francisco</city><state>CA</state><postal_code>94110</postal_code></address><phone>4152853333</phone><latitude>37.747008</latitude><longitude>-122.420154</longitude><image_url xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><business_hours>Mon-Fri 8am-5pm
Sat 8am-12pm</business_hours><tags><tag id="12743" primary="false">Transmission Repair</tag><tag id="12749" primary="false">Brake Repair</tag><tag id="268" primary="true">Automotive Repair</tag><tag id="237" primary="false">Automotive Sales &amp; Services</tag></tags><public_id>valencia-auto-clinic-sf</public_id></location></locations><offer_collapse_count xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/></offer><offer><attribution_logo>http://images.citysearch.net/assets/imgdb/custom/ue-357/CS_logo88x31.jpg</attribution_logo><attribution_source>CUSTOMER</attribution_source><attribution_text>Citysearch</attribution_text><attribution_url xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><id>cg_74498002</id><reference_id>11</reference_id><impression_id>000b0000023819aadf9979424c9d2444a8e948c41f</impression_id><title>Save money on tires and wheels! Visit our site to learn more about our specials, promos &amp; rebates!</title><description>Save time and money - shop, research, and buy your next set of tires online. Visit our site to learn more about current specials, promotions, and rebates.</description><redemption_type_id>3</redemption_type_id><redemption_type>Both</redemption_type><terms>Please visit the \'Rebate Forms\' page at www.discounttire.com for more details.</terms><redemption_url>http://www.discounttire.com/dtcs/home.do?utm_source=Citysearch&amp;utm_medium=iyp&amp;utm_campaign=CitysearchIYP</redemption_url><offer_source>CUSTOMER</offer_source><offer_types><offer_type>dollarsoff</offer_type></offer_types><image_url>http://images.citysearch.net/assets/imgdb/merchant/2011/1/4/0/DKDImveh208_100x100.jpeg</image_url><start_date>2011-01-04T00:00:00.000Z</start_date><expiration_date xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><popularity xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><face_value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><discount_value xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><locations><location><id>848312</id><infousa_id>472607647</infousa_id><rating xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><name>Americas Tire</name><address><street>1610 Broadway</street><city>Redwood City</city><state>CA</state><postal_code>94063</postal_code></address><phone>6503664003</phone><latitude>37.486959</latitude><longitude>-122.218542</longitude><image_url>http://images.citysearch.net/assets/imgdb/merchant/2010/6/9/0/Wjiqilvi172_100x100.jpeg</image_url><business_hours xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/><tags><tag id="237" primary="true">Automotive Sales &amp; Services</tag></tags><public_id>americas-tire-redwood-city-2</public_id></location></locations><offer_collapse_count xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:nil="true"/></offer></offers></results>







=cut

1;
__END__


=head1 NAME

WebService-CityGrid-Content-Offers - CityGrid content offers interface

=head1 SYNOPSIS

  use WebService-CityGrid-Content-Offers;
  blah blah blah

=head1 DESCRIPTION

Interface to C

=head2 EXPORT

None by default.



=head1 SEE ALSO

=head1 AUTHOR

Fred Moyer, E<lt>fred@slwifi.comE<gt>

=head1 COPYRIGHT AND LICENSE

Copyright (C) 2011 by Fred Moyer

This library is free software; you can redistribute it and/or modify
it under the same terms as Perl itself, either Perl version 5.14.1 or,
at your option, any later version of Perl 5 you may have available.


=cut
